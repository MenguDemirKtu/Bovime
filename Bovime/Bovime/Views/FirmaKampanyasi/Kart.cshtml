@{
ViewBag.Title = "Kart";
Layout = "~/Views/_ana.cshtml";
}
@using Bovime
@using Bovime.veri
@model Bovime.Models.FirmaKampanyasiModel
<script src="~/assets/js/jquery.dataTables.min.js"></script>
<form id="formKayit" name="formKayit" autocomplete="off">
@{
int   dilKimlik = Model.gecerliDil();
}
<div class="@Ayar.tamGenislik">
<div class="row">
@Html.HiddenFor(model => model.fotoKonumu)
<div class=@Ayar.yariGenislik>
                <div class="@Ayar.formGrup">
                    <label  class="@Ayar.labelBicim"> @Ayar.sozcuk("Firma", dilKimlik)  </label>
                    @Html.DropDownListFor(m => m.kartVerisi.i_firmaKimlik, Bilesen.doldur(Model._ayFirmaAYRINTI) ,  @Ayar.sozcuk("Lütfen Seçiniz", dilKimlik), new { @class = "form-control select2" })
                </div>
            </div>
       @Html.HiddenFor(model => model.kartVerisi.firmaKampanyasikimlik)
       @Html.HiddenFor(model => model.kartVerisi.kampanyaKodu)
       @Html.HiddenFor(model => model.kartVerisi.i_fotoKimlik) 
       @Html.HiddenFor(model => model.kartVerisi.varmi)
       @Html.HiddenFor(model => model.kartVerisi.y_firmaKampanyaTalebiKimlik)
<div class=@Ayar.yariGenislik>
                <div class="@Ayar.formGrup">

                    <label class="@Ayar.labelBicim"> @Ayar.sozcuk(Model._fotoTanimi(), dilKimlik)  </label>
                    <input id="files" name="files" type="file" size="1" class="@Ayar.dosyaYukleyiciBicim()" multiple onchange="fotoYukle('files');" />
	<img id="imYuklenen" src="@Model.fotoKonumu" width="0" height="0" />
                </div>
            </div>
<div class=@Ayar.yariGenislik>
                <div class="@Ayar.formGrup">
                    <label  class="@Ayar.labelBicim"> @Ayar.sozcuk("Açıklama", dilKimlik)  </label>
                    @Html.TextBoxFor(m => m.kartVerisi.aciklama, new { @class = @Ayar.textBoxBicim(), maxlength = "500" ,   placeholder = @Ayar.sozcuk("Açıklama", dilKimlik) }) 
                </div>
            </div>
<div class=@Ayar.yariGenislik>
                <div class="@Ayar.formGrup">
                    <label  class="@Ayar.labelBicim"> @Ayar.sozcuk("Yayın Başlangıç", dilKimlik)  </label>
				 @Html.TextBoxFor(m => m.kartVerisi.yayinBaslangic, "{0:yyyy-MM-dd}", new { type = "date", @class = "form-control" })
                </div>
            </div>
<div class=@Ayar.yariGenislik>
                <div class="@Ayar.formGrup">
                    <label  class="@Ayar.labelBicim"> @Ayar.sozcuk("Yayın Bitiş", dilKimlik)  </label>
				 @Html.TextBoxFor(m => m.kartVerisi.yayinBitis, "{0:yyyy-MM-dd}", new { type = "date", @class = "form-control" })
                </div>
            </div>
<div class=@Ayar.yariGenislik>
                <div class="@Ayar.formGrup">
                    <label  class="@Ayar.labelBicim"> @Ayar.sozcuk("Hedef Url", dilKimlik)  </label>
                    @Html.TextBoxFor(m => m.kartVerisi.hedefUrl, new { @class = @Ayar.textBoxBicim(), maxlength = "400" ,   placeholder = @Ayar.sozcuk("Hedef Url", dilKimlik) }) 
                </div>
            </div>
<div class=@Ayar.yariGenislik>
                <div class="@Ayar.formGrup">
                    <label  class="@Ayar.labelBicim"> @Ayar.sozcuk("Ön Kod", dilKimlik)  </label>
                    @Html.TextBoxFor(m => m.kartVerisi.onKod, new { @class = @Ayar.textBoxBicim(), maxlength = "5" ,   placeholder = @Ayar.sozcuk("Ön Kod", dilKimlik) }) 
                </div>
            </div>
<div class=@Ayar.yariGenislik>
                <div class="@Ayar.formGrup">
                    <label  class="@Ayar.labelBicim"> @Ayar.sozcuk("Sırası", dilKimlik)  </label>
                    @Html.TextBoxFor(m => m.kartVerisi.sirasi, new { @class = @Ayar.textBoxBicim(),   placeholder = @Ayar.sozcuk("Sırası", dilKimlik) }) 
                </div>
            </div>
<div class=@Ayar.yariGenislik>
                <div class="@Ayar.formGrup">
                    <label  class="@Ayar.labelBicim"> @Ayar.sozcuk("Başlık", dilKimlik)  </label>
                    @Html.TextBoxFor(m => m.kartVerisi.baslik, new { @class = @Ayar.textBoxBicim(), maxlength = "200" ,   placeholder = @Ayar.sozcuk("Başlık", dilKimlik) }) 
                </div>
            </div>
<div class=@Ayar.tamGenislik>
                <br />
                <div class="card table-card">
                    <div class="card-header pb-0">
                        <h4> 
              @Ayar.sozcuk("Metin", dilKimlik)  
</h4>
                    </div> 
                    @Html.TextAreaFor(m => m.kartVerisi.metin, new { @id = "elm1", name = "elm1" })
                </div>
            </div>
<div class=@Ayar.yariGenislik>
                <div class="@Ayar.formGrup">
                    <label  class="@Ayar.labelBicim"> @Ayar.sozcuk("Durum", dilKimlik)  </label>
                    @Html.DropDownListFor(m => m.kartVerisi.i_kampanyaDurumuKimlik, Bilesen.doldur(Model._ayref_KampanyaDurumu) ,  @Ayar.sozcuk("Lütfen Seçiniz", dilKimlik), new { @class = "form-control select2" })
                </div>
            </div>
@Html.HiddenFor(model => model.yenimi)
</div>
<hr />
<button type="button" onclick="ekle(); return false;" id="btnKaydet" class="btn btn-success" data-bs-toggle="modal">
@Ayar.sozcuk("Kaydet", dilKimlik)
</button>
</div>
</form>
<script>
    @Html.Raw(Ayar.yukleyiciIfadesi())
</script>
<script>
  function ekle() {
     tinyMCE.triggerSave();
     var valdata = $("#formKayit").serialize();
     console.table(valdata);
     $.ajax({
         url: "/FirmaKampanyasi/Kaydet/",
         type: "Post",
         data: valdata,
         contentType: "application/x-www-form-urlencoded; charset=UTF-8",
         dataType: "json",
         success: function(response) {
             if (!response.success) {
                 Swal.fire(
                     '@Ayar.sozcuk("Hata", dilKimlik)',
                     response.message,
                     'error');
                 return false;
             } else {
                 Swal.fire('@Ayar.sozcuk("Başarılı", dilKimlik)', response.message,
                     'success').then(function() {
                     if (response.yonlensinmi == true) {
                         window.location.href = response.yonlenmeAdresi;
                     }
                     var deger = String(document.getElementById("yenimi").value);
                     if (deger == "True") {
                         window.location.reload();
                     }
                 })
             }
         }
     });
 }

 function fotoYukle(inputId) {
     var input = document.getElementById(inputId);
     var files = input.files;
     var formData = new FormData();
     for (var i = 0; i != files.length; i++) {
         formData.append("files", files[i]);
     }
     $.ajax({
         url: "/GeciciDosya/CokluYukle",
         data: formData,
         processData: false,
         contentType: false,
         type: "POST",
         success: function(response) {
             var deger = response.message.split('>');
             $('#imYuklenen').attr('src', deger[1]);
             $('#imYuklenen').attr('height', '210');
             $('#imYuklenen').attr('width', '280');
             $('#fotoKonumu').val(deger[0]);
         }
     });
 }
</script>

